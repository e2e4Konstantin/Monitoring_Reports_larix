# Обработка отчета мониторинга материалов.
Получаем файл c отчетом мониторинга материалов за месяц.

## Задача
 - сформировать отпускные цены для загрузки в АИС
 - контроль изменения условий цены
 - для оценки значимых колебаний рассчитать индексы и абсолютные значения изменения цены для прошлого и текущего периодов
 - сравнить индексы в абсолютных значениях и в %
    *Критерий значимости экспертный.*

Цены необходимо рассчитать потому что, что некоторые позиции в исходном файле указаны с доставкой некоторые без. 

*Иногда поставщики не выделяют доставку.*

Ищем цены помеченные "с доставкой", рассчитываем цену доставки, выдаем чистую цену. 
Доставка рассчитывается по данным АИС для шифра из таблицы:
    *larix.transport_cost*
    **Цена базовая * Коэффициент тр.затрат * вес.брутто/1000**

## Контроль
Из АИС загрузить данные мониторинга за прошлые периоды. 
На основном отчете указать что цена прошлого периода была с доставкой/без доставки, чтобы было видно что произошло изменение условий цены.
По загруженным из АИС данным сформировать сводную таблицу истории цен мониторинга материалов. 



Подсветить те цены и шифры которые были с доставкой.
Рассчитать для каждого шифра: 
- количество изменений условий цены за исторический период
- среднее значение, среднее отклонение и скорость изменения цены

# Модель данных
Материалы: Глава 1. без 0 раздела: 
    `(pressmark LIKE '1.%%' AND NOT LIKE '1.0%%')`
## Периоды
- период мониторинга на который сделан отчет 
- предыдущий период мониторинга, для сравнения условий цены
- последний период дополнения, по нему получаем первичные данные на материалы
- последний индексный период, по нему берем актуальные цены

Для периода дополнения SP и индексного периода IP.
Из отчета мониторинга берется список материалов (файл).
доступные материалы берутся для SP. Цены и другие данные берутся для IP.



# Как пользоваться

1. создать БД 
    `create_new_support_db_1.py create_support_db(db_name)`
2. прочитать данные для периода 
    \```
    read_prepare_larix_data_2.py:
    get_materials_from_larix(period_pattern)
    get_history_prices_materials_from_larix(PRICE_HISTORY_START_DATE)
    
    get_monitoring_materials_from_larix(DB_FILE, PRICE_HISTORY_START_DATE)
    \```
3. читать исходный файл от мониторинга load_monitoring_file.py
4. create_material_monitoring_report()
5. create_monitoring_price_history_report()